<!DOCTYPE html>
<html>
<head>
    <title>Test Contact API</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea { width: 100%; padding: 8px; box-sizing: border-box; }
        button { padding: 10px 20px; background: #0066cc; color: white; border: none; cursor: pointer; }
        button:hover { background: #0052a3; }
        .log { border: 1px solid #ccc; padding: 10px; margin-top: 20px; background: #f5f5f5; max-height: 300px; overflow-y: auto; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Test Contact API</h1>
    
    <div>
        <h3>User Info:</h3>
        <p>Token: <code id="tokenDisplay">Loading...</code></p>
        <p>User: <code id="userDisplay">Loading...</code></p>
    </div>

    <form id="contactForm">
        <div class="form-group">
            <label>Ch·ªß ƒë·ªÅ:</label>
            <input type="text" id="subject" placeholder="Nh·∫≠p ch·ªß ƒë·ªÅ" required>
        </div>
        <div class="form-group">
            <label>N·ªôi dung:</label>
            <textarea id="message" placeholder="Nh·∫≠p n·ªôi dung" rows="5" required></textarea>
        </div>
        <button type="submit">G·ª≠i Tin Nh·∫Øn</button>
    </form>

    <div class="log" id="log"></div>

    <script>
        const log = (msg, type = 'log') => {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = type;
            entry.textContent = new Date().toLocaleTimeString() + ' - ' + msg;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(msg);
        };

        // Get token from localStorage
        const token = localStorage.getItem('token');
        const user = localStorage.getItem('user');
        
        document.getElementById('tokenDisplay').textContent = token ? token.substring(0, 30) + '...' : 'No token found';
        document.getElementById('userDisplay').textContent = user ? user.substring(0, 50) + '...' : 'No user found';

        if (!token) {
            log('‚ùå ERROR: No token found in localStorage. Please login first.', 'error');
        } else {
            log('‚úÖ Token found in localStorage', 'success');
        }

        // Form submission
        document.getElementById('contactForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const subject = document.getElementById('subject').value;
            const message = document.getElementById('message').value;

            log('üì§ Sending request...', 'log');
            log(`Subject: ${subject}`, 'log');
            log(`Message: ${message.substring(0, 50)}...`, 'log');

            try {
                const response = await fetch('http://127.0.0.1:8000/api/contacts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify({ subject, message })
                });

                const data = await response.json();
                
                log(`Status Code: ${response.status}`, 'log');
                
                if (response.ok && data.status) {
                    log('‚úÖ SUCCESS: ' + data.message, 'success');
                    document.getElementById('contactForm').reset();
                } else {
                    log('‚ùå ERROR: ' + (data.message || 'Unknown error'), 'error');
                }
                
                log('Response: ' + JSON.stringify(data).substring(0, 100) + '...', 'log');
            } catch (error) {
                log('‚ùå FETCH ERROR: ' + error.message, 'error');
            }
        });

        log('Page loaded. Token and user info displayed above.', 'log');
    </script>
</body>
</html>
